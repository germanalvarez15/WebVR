<html>
  <head>
    <script src="https://aframe.io/releases/0.9.1/aframe.min.js"></script>

  </head>
  <body>
    <a-scene id="escena">
		
	<!-- CURSOR ENTITY -->
	 <a-entity position="0 1.8 0">
		<a-entity
			id="camera"
			camera
			look-controls
			rotation="0 0 0"
			wasd-controls
		>
			<a-entity
				cursor="fuse: true; maxDistance: 500; timeout: 3000;"
				id="cursor-main"
				position="0 0 -2"
				geometry="primitive: ring; radiusOuter: 0.06; radiusInner: 0.03; thetaLength: 360; thetaStart: 90;"
				material="color: #439DC2;"
				animation="property: geometry.thetaLength;startEvents:mouseleave;from:0;to:360;autoplay:false;dur:0"
				animation__2="property: geometry.thetaLength; from:360; to:0;fill:forwards;easing:easeInCirc;startEvents:mouseenter;autoplay:false;dur:2000"    
			>
			</a-entity>
			<a-entity
				id="cursor-loader"
				position="0 0 -2.001"
				geometry="primitive: ring; radiusOuter: 0.06; radiusInner: 0.03;"
				material="color: #2ADD2A;"
			>
			</a-entity>
		</a-entity>
	</a-entity>
		<!--DEPRECATED
		<a-entity id="player" camera="active: false" position="0 1.6 0" wasd-controls="" rotation="" look-controls="" aframe-injected="" data-aframe-inspector-original-camera="" visible="" collider-check>
			<a-entity id= "raycaster" raycaster="objects: .collidable" position="0 -0.9 0" rotation="90 0 0"></a-entity>
			<a-entity geometry="primitive: circle; radius: 0.05" material="color: #b9b900" position="0 0 -1.22179"></a-entity>
		</a-entity>-->

		<a-entity class="collidable" id="Marte" geometry="primitive: sphere" position="1 1.3 -4" animation="property: rotation; to: 0 360 0; loop: true; dur: 100000; easing:linear;" material="src: https://raw.githubusercontent.com/germanalvarez15/SolarSystemGVR/master/Assets/Planetas/Marte/mars_1k_color.jpg"  collider-check raycaster-listen></a-entity>
		<a-entity class="collidable" id="Tierra" geometry="primitive: sphere" position="0 1.3 4" animation="property: rotation; to: 0 360 0; loop: true; dur: 100000; easing:linear;" material="src: https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/i/4013c234-b843-4331-84cd-8a86d940d26f/dcrbmun-38493001-d0cc-4bd6-9acb-2bf1109b488b.jpg"  collider-check raycaster-listen></a-entity>

		<a-entity rotation="0 0 0" animation="property: rotation; to: 0 -360 0; loop: true; dur: 150000;easing:linear;">
  			<a-entity position="5 0 0">
				<a-entity class="collidable" id="Jupiter" geometry="primitive: sphere" position="26 1.3 -55.36108" animation="property: rotation; to: 0 360 0; loop: true; dur: 50000;easing:linear;" material="src: jupiter.jpg" collider-check="" raycaster-listen="" raycaster="" rotation="0 192.672996192 0" scale="13 13 13"></a-entity>
			</a-entity>
		</a-entity>

		<a-entity rotation="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 150000;easing:linear;">
  			<a-entity position="5 0 0">
				<a-entity class="collidable" id="Venus" geometry="primitive: sphere" position="6 1.3 15.36108" animation="property: rotation; to: 0 360 0; loop: true; dur: 100000;easing:linear;" material="src: venus.jpg" collider-check="" raycaster-listen="" raycaster="" rotation="0 192.672996192 0" scale="0.5 0.5 0.5"></a-entity>
			</a-entity>
		</a-entity>

		<a-entity id="textoNombrePlaneta"></a-entity>
		
		<a-image src="#siguiente" material="" geometry="" position="-1.50 0 -1" rotation="45 -90 180"></a-image>

		<a-image src="#anterior" material="" geometry="" position="-1.5 0 1" rotation="45 -90 180"></a-image>

		<a-assets>
		<img id="siguiente" src="botonDerecha.png">
		<img id="anterior" src="botonIzquierda.png">

		<img id="sky" src="skybox.jpg">
		</a-assets>
	  <a-sky src="#sky"></a-sky>
    </a-scene>

<script>

		var textoPlaneta;
AFRAME.registerComponent('collider-check', {
  dependencies: ['raycaster'],
});

AFRAME.registerComponent('raycaster-listen', {
	init: function () {
		textoPlaneta = document.getElementById('textoNombrePlaneta');


	    // Use events to figure out what raycaster is listening so we don't have to
	    // hardcode the raycaster.
	    this.el.addEventListener('raycaster-intersected', evt => {
	      this.raycaster = evt.detail.el;
	    });
	    this.el.addEventListener('raycaster-intersected-cleared', evt => {
	      this.raycaster = null;
	    });
  	},

  	tick: function () {
	    if (!this.raycaster) { return; }  // Not intersecting.
		var ultimoPlanetaApuntado;
	    let intersection = this.raycaster.components.raycaster.getIntersection(this.el);
	    if (!intersection) { return; }
	    //console.log("Objeto apuntado: " + intersection.object.el.id);
		//console.log(intersection.object.el.object3D.position.z);
		//console.log("Posicion Z planeta: " + intersection.object.el);
		//console.log(textoPlaneta);
		//console.log(intersection.object.el.id + "        " + ultimoPlanetaApuntado);
		if(textoPlaneta != null && (intersection.object.el.id != ultimoPlanetaApuntado)){
			ultimoPlanetaApuntado = intersection.object.el.id;
			var posTexto = intersection.object.el.object3D.position.x + " " + (intersection.object.el.object3D.position.y + 1.35) + " " +  intersection.object.el.object3D.position.z;
			//console.log(posTexto);
			//intersection.object.el.visible = true;
			textoPlaneta.setAttribute('text__planeta',{
			'value':intersection.object.el.id,
			'width':5,
			'align':'center',
			'color': '#FFF',
			});
			textoPlaneta.setAttribute('position',posTexto);
			//Modificar para que sea dinamico, detectar por donde estas parado y que cada planeta sea anterior y siguiente.
			if(intersection.object.el.id == "Tierra"){
				textoPlaneta.setAttribute('rotation','0 180 0');

			}else{
				textoPlaneta.setAttribute('rotation','0 0 0');
			}
			textoPlaneta.setAttribute('id','texto' + intersection.object.el.id);			
		}else {

			return;
		}
  	}
});




/*
  init: function () {
	var ray = document.querySelector('#raycaster');
	var escena = document.querySelector('#escena');
	var textoPlaneta;
	this.el.addEventListener('raycaster-intersection', function () {
		textoPlaneta = document.getElementById('textoPlaneta');
		//console.log(ray.components.raycaster.objects);
		console.log(ray.components.raycaster);

		if(ray.components.raycaster.objects.length > 0 && textoPlaneta != null){
			
			var posTexto = '0' + " " + (ray.components.raycaster.objects[0].parent.position.y + 1.35) + " " +  '-2.745';
			//console.log(posTexto);
			textoPlaneta.object3D.visible = true;
			textoPlaneta.setAttribute('text__planeta',{
			'value':ray.components.raycaster.objects[0].el.id,
			'width':5,
			'align':'center',
			'color': '#FFF',
			});
			textoPlaneta.setAttribute('position',posTexto);
			textoPlaneta.setAttribute('rotation','0 0 0');
			textoPlaneta.setAttribute('id','texto' + ray.components.raycaster.objects[0].el.id);

			//ray.components.raycaster.objects[0].position.set(1, 2, 3);
			//ray.components.raycaster.objects[0].position.x += 5;
			//ray.components.raycaster.objects[0].position.multiplyScalar(5);
			//console.log(ray.components.raycaster.raycaster.objects);
		}else{
			//console.log("No apunta a nada");

		}
    });
  }
});*/

  </script>
  </body>

</html>